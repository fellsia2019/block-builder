<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naberika - Чистый JavaScript</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .blocks-container {
            width: 100%;
            margin: 20px 0;
        }

        .block {
            width: 100%;
            margin-bottom: 30px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: rgba(0, 123, 255, 0.05);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .block:hover {
            background: rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }

        .block.selected {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
        }

        .block.locked {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.05);
        }

        .block-header {
            background: rgba(0, 123, 255, 0.1);
            padding: 10px 15px;
            border-bottom: 1px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #2c3e50;
        }

        .block-content {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #333;
            min-height: 60px;
        }

        .block.hidden {
            opacity: 0.3;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #4facfe;
        }

        .log {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-entry.success {
            color: #50fa7b;
        }

        .log-entry.error {
            color: #ff5555;
        }

        .log-entry.info {
            color: #8be9fd;
        }

        .log-entry.warning {
            color: #ffb86c;
        }

        .architecture-diagram {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }

        .architecture-diagram h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .layer {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
        }

        .layer-core {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .layer-infrastructure {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .layer-ui {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .arrow {
            text-align: center;
            font-size: 1.5rem;
            color: #666;
            margin: 5px 0;
        }

        /* Стили для модальных окон форм */
        .form-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
        }

        .form-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .form-dialog {
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .form-dialog-header h3 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: #333;
        }

        .form-dialog-content {
            padding: 20px;
        }

        .form-description {
            margin: 0 0 20px 0;
            color: #666;
            font-size: 14px;
        }

        .naberika-form {
            max-width: none;
            margin: 0;
            padding: 0;
            background: none;
            border-radius: 0;
            box-shadow: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label input {
            margin-right: 8px;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .form-control.error {
            border-color: #dc3545;
        }

        .field-errors {
            margin-top: 5px;
            font-size: 12px;
            color: #dc3545;
        }

        .field-errors .error {
            display: block;
            margin-bottom: 2px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Стили для кнопок управления блоками */
        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #2c3e50;
        }

        .block-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .block-type {
            font-weight: 600;
            text-transform: capitalize;
        }

        .block-id {
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }

        .lock-icon, .hidden-icon {
            font-size: 12px;
        }

        .block-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .card-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-section h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 8px;
        }

        .control-btn {
            background: none;
            border: none;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }

        .control-btn:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.1);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .edit-btn:hover {
            background: rgba(0, 123, 255, 0.2);
        }

        .move-up-btn:hover, .move-down-btn:hover {
            background: rgba(40, 167, 69, 0.2);
        }

        .toggle-visibility-btn:hover, .toggle-lock-btn:hover {
            background: rgba(255, 193, 7, 0.2);
        }

        .delete-btn:hover {
            background: rgba(220, 53, 69, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏗️ Naberika - Чистый JavaScript</h1>
            <p>Блочный конструктор с чистой архитектурой</p>
        </div>

        <div class="content">
            <!-- Архитектура -->
            <div class="demo-section">
                <h2>🎯 Чистая архитектура</h2>
                <div class="architecture-diagram">
                    <h3>Слои архитектуры</h3>
                    <div class="layer layer-ui">🎨 UI Layer</div>
                    <div class="arrow">⬇️</div>
                    <div class="layer layer-core">🎯 Core Layer (Use Cases)</div>
                    <div class="arrow">⬇️</div>
                    <div class="layer layer-infrastructure">🔧 Infrastructure Layer</div>
                </div>
            </div>

            <!-- Управление блоками -->
            <div class="demo-section">
                <h2>📦 Управление блоками</h2>
                <div class="controls">
                    <button class="btn btn-primary" onclick="showCreateForm('text')">
                        📝 Добавить текст
                    </button>
                    <button class="btn btn-success" onclick="showCreateForm('image')">
                        🖼️ Добавить изображение
                    </button>
                    <button class="btn btn-info" onclick="showCreateForm('button')">
                        🔘 Добавить кнопку
                    </button>
                    <button class="btn btn-warning" onclick="showCreateForm('cardlist')">
                        🃏 Добавить карточки
                    </button>
                    <button class="btn btn-warning" onclick="addContainerBlock()">
                        📦 Добавить контейнер
                    </button>
                    <button class="btn btn-danger" onclick="clearAllBlocks()">
                        🗑️ Очистить все
                    </button>
                </div>

                <div class="blocks-container" id="blocks-container"></div>

                <div class="stats">
                    <div class="stat-card">
                        <h3>Всего блоков</h3>
                        <div class="number" id="totalBlocks">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Выбранный блок</h3>
                        <div class="number" id="selectedBlock">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Заблокированные</h3>
                        <div class="number" id="lockedBlocks">0</div>
                    </div>
                </div>
            </div>

            <!-- Лог -->
            <div class="demo-section">
                <h2>📋 Лог операций</h2>
                <div class="log" id="log"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Импорт Naberika (в реальном проекте)
        // import { BlockManagementUseCase, MemoryBlockRepositoryImpl, MemoryComponentRegistry } from '../index.js';

        // Имитация Naberika для демонстрации
        class SimpleBlock {
            constructor(data) {
                this.id = `block_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                this.type = data.type;
                this.settings = data.settings || {};
                this.props = data.props || {};
                this.template = data.template;
                this.visible = data.visible !== false;
                this.locked = data.locked || false;
                this.selected = false;
            }

            updateSettings(newSettings) {
                this.settings = { ...this.settings, ...newSettings };
            }

            updateProps(newProps) {
                this.props = { ...this.props, ...newProps };
            }

            setLocked(locked) {
                this.locked = locked;
            }

            setVisible(visible) {
                this.visible = visible;
            }

            setSelected(selected) {
                this.selected = selected;
            }
        }

        // Глобальные переменные
        let blocks = [];
        let selectedBlockId = null;

        // Утилиты
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStats() {
            document.getElementById('totalBlocks').textContent = blocks.length;
            document.getElementById('selectedBlock').textContent = selectedBlockId || '-';
            document.getElementById('lockedBlocks').textContent = blocks.filter(b => b.locked).length;
        }

        function renderBlocks() {
            const container = document.getElementById('blocks-container');
            container.innerHTML = '';

            blocks.forEach((block, index) => {
                const blockElement = document.createElement('div');
                blockElement.className = 'block';
                blockElement.id = block.id;
                
                if (block.selected) blockElement.classList.add('selected');
                if (block.locked) blockElement.classList.add('locked');
                if (!block.visible) blockElement.classList.add('hidden');

                // Создаем заголовок блока с кнопками управления
                const headerElement = document.createElement('div');
                headerElement.className = 'block-header';
                headerElement.innerHTML = `
                    <div class="block-info">
                        <span class="block-type"><strong>${block.type}</strong></span>
                        <span class="block-id">${block.id.slice(-8)}</span>
                        ${block.locked ? '<span class="lock-icon">🔒</span>' : ''}
                        ${!block.visible ? '<span class="hidden-icon">👁️‍🗨️</span>' : ''}
                    </div>
                    <div class="block-controls" style="display: ${block.selected ? 'flex' : 'none'}">
                        <button class="control-btn edit-btn" onclick="editBlock('${block.id}')" title="Редактировать">✏️</button>
                        <button class="control-btn move-up-btn" onclick="moveBlockUp('${block.id}')" title="Переместить вверх" ${index === 0 ? 'disabled' : ''}>⬆️</button>
                        <button class="control-btn move-down-btn" onclick="moveBlockDown('${block.id}')" title="Переместить вниз" ${index === blocks.length - 1 ? 'disabled' : ''}>⬇️</button>
                        <button class="control-btn toggle-visibility-btn" onclick="toggleBlockVisibility('${block.id}')" title="${block.visible ? 'Скрыть' : 'Показать'}">${block.visible ? '👁️' : '👁️‍🗨️'}</button>
                        <button class="control-btn toggle-lock-btn" onclick="toggleBlockLock('${block.id}')" title="${block.locked ? 'Разблокировать' : 'Заблокировать'}">${block.locked ? '🔓' : '🔒'}</button>
                        <button class="control-btn delete-btn" onclick="deleteBlock('${block.id}')" title="Удалить">🗑️</button>
                    </div>
                `;

                // Создаем контент блока
                const contentElement = document.createElement('div');
                contentElement.className = 'block-content';

                // Рендерим содержимое из template
                if (block.template) {
                    let content = block.template;
                    Object.entries(block.props).forEach(([key, value]) => {
                        content = content.replace(new RegExp(`{{ props.${key} }}`, 'g'), value);
                    });
                    Object.entries(block.settings).forEach(([key, value]) => {
                        content = content.replace(new RegExp(`{{ settings.${key} }}`, 'g'), value);
                    });
                    contentElement.innerHTML = content;
                } else {
                    contentElement.textContent = block.props.content || block.type;
                }

                blockElement.appendChild(headerElement);
                blockElement.appendChild(contentElement);

                // Обработчики событий
                blockElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectBlock(block.id);
                });

                container.appendChild(blockElement);
            });
        }

        function selectBlock(blockId) {
            blocks.forEach(block => block.setSelected(block.id === blockId));
            selectedBlockId = blockId;
            updateStats();
            renderBlocks();
            
            const block = blocks.find(b => b.id === blockId);
            if (block) {
                log(`Выбран блок: ${block.type} (${blockId})`, 'success');
            }
        }

        // Функции управления блоками
        window.editBlock = function(blockId) {
            const block = blocks.find(b => b.id === blockId);
            if (!block) return;

            const formConfigs = {
                'text': {
                    title: 'Редактирование текстового блока',
                    description: 'Измените параметры текстового блока',
                    fields: [
                        {
                            field: 'content',
                            label: 'Текст',
                            type: 'textarea',
                            placeholder: 'Введите текст...',
                            rules: [
                                { type: 'required', field: 'content', message: 'Текст обязателен для заполнения' },
                                { type: 'minLength', field: 'content', value: 1, message: 'Текст не может быть пустым' }
                            ],
                            defaultValue: block.props.content || ''
                        },
                        {
                            field: 'fontSize',
                            label: 'Размер шрифта',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'fontSize', message: 'Размер шрифта обязателен' },
                                { type: 'min', field: 'fontSize', value: 8, message: 'Минимальный размер шрифта: 8px' },
                                { type: 'max', field: 'fontSize', value: 72, message: 'Максимальный размер шрифта: 72px' }
                            ],
                            defaultValue: parseInt(block.settings.fontSize) || 16
                        },
                        {
                            field: 'color',
                            label: 'Цвет текста',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'color', message: 'Цвет обязателен' }
                            ],
                            defaultValue: block.settings.color || '#333333'
                        },
                        {
                            field: 'textAlign',
                            label: 'Выравнивание',
                            type: 'select',
                            options: [
                                { value: 'left', label: 'По левому краю' },
                                { value: 'center', label: 'По центру' },
                                { value: 'right', label: 'По правому краю' },
                                { value: 'justify', label: 'По ширине' }
                            ],
                            rules: [
                                { type: 'required', field: 'textAlign', message: 'Выравнивание обязательно' }
                            ],
                            defaultValue: block.props.textAlign || 'left'
                        }
                    ],
                    submitButtonText: 'Сохранить изменения',
                    cancelButtonText: 'Отмена'
                },
                'image': {
                    title: 'Редактирование блока изображения',
                    description: 'Измените параметры блока изображения',
                    fields: [
                        {
                            field: 'src',
                            label: 'URL изображения',
                            type: 'url',
                            placeholder: 'https://example.com/image.jpg',
                            rules: [
                                { type: 'required', field: 'src', message: 'URL изображения обязателен' },
                                { type: 'url', field: 'src', message: 'Введите корректный URL' }
                            ],
                            defaultValue: block.props.src || ''
                        },
                        {
                            field: 'alt',
                            label: 'Альтернативный текст',
                            type: 'text',
                            placeholder: 'Описание изображения',
                            rules: [
                                { type: 'required', field: 'alt', message: 'Альтернативный текст обязателен' }
                            ],
                            defaultValue: block.props.alt || ''
                        },
                        {
                            field: 'borderRadius',
                            label: 'Скругление углов',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'borderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'borderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: parseInt(block.settings.borderRadius) || 0
                        },
                        {
                            field: 'width',
                            label: 'Ширина',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'width', message: 'Ширина обязательна' },
                                { type: 'min', field: 'width', value: 50, message: 'Минимальная ширина: 50px' },
                                { type: 'max', field: 'width', value: 1200, message: 'Максимальная ширина: 1200px' }
                            ],
                            defaultValue: 300
                        },
                        {
                            field: 'height',
                            label: 'Высота',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'height', message: 'Высота обязательна' },
                                { type: 'min', field: 'height', value: 50, message: 'Минимальная высота: 50px' },
                                { type: 'max', field: 'height', value: 800, message: 'Максимальная высота: 800px' }
                            ],
                            defaultValue: 200
                        }
                    ],
                    submitButtonText: 'Сохранить изменения',
                    cancelButtonText: 'Отмена'
                },
                'button': {
                    title: 'Редактирование кнопки',
                    description: 'Измените параметры кнопки',
                    fields: [
                        {
                            field: 'text',
                            label: 'Текст кнопки',
                            type: 'text',
                            placeholder: 'Нажми меня',
                            rules: [
                                { type: 'required', field: 'text', message: 'Текст кнопки обязателен' },
                                { type: 'minLength', field: 'text', value: 1, message: 'Текст не может быть пустым' }
                            ],
                            defaultValue: block.props.text || 'Кнопка'
                        },
                        {
                            field: 'backgroundColor',
                            label: 'Цвет фона',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'backgroundColor', message: 'Цвет фона обязателен' }
                            ],
                            defaultValue: block.settings.backgroundColor || '#007bff'
                        },
                        {
                            field: 'color',
                            label: 'Цвет текста',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'color', message: 'Цвет текста обязателен' }
                            ],
                            defaultValue: block.settings.color || '#ffffff'
                        },
                        {
                            field: 'borderRadius',
                            label: 'Скругление углов',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'borderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'borderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: parseInt(block.settings.borderRadius) || 4
                        },
                        {
                            field: 'padding',
                            label: 'Отступы',
                            type: 'text',
                            placeholder: '8px 16px',
                            rules: [
                                { type: 'required', field: 'padding', message: 'Отступы обязательны' }
                            ],
                            defaultValue: block.settings.padding || '8px 16px'
                        },
                        {
                            field: 'onClick',
                            label: 'Обработчик клика',
                            type: 'text',
                            placeholder: 'alert("Привет!")',
                            rules: [
                                { type: 'required', field: 'onClick', message: 'Обработчик клика обязателен' }
                            ],
                            defaultValue: block.props.onClick || 'alert("Привет!")'
                        }
                    ],
                    submitButtonText: 'Сохранить изменения',
                    cancelButtonText: 'Отмена'
                },
                'cardlist': {
                    title: 'Редактирование списка карточек',
                    description: 'Измените параметры списка карточек',
                    fields: [
                        {
                            field: 'title',
                            label: 'Заголовок списка',
                            type: 'text',
                            placeholder: 'Наши услуги',
                            rules: [
                                { type: 'required', field: 'title', message: 'Заголовок обязателен' },
                                { type: 'minLength', field: 'title', value: 1, message: 'Заголовок не может быть пустым' }
                            ],
                            defaultValue: block.props.title || 'Наши услуги'
                        },
                        {
                            field: 'card1_title',
                            label: 'Карточка 1 - Заголовок',
                            type: 'text',
                            placeholder: 'Веб-разработка',
                            rules: [
                                { type: 'required', field: 'card1_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[0] ? block.props.cards[0].title : 'Веб-разработка'
                        },
                        {
                            field: 'card1_text',
                            label: 'Карточка 1 - Описание',
                            type: 'textarea',
                            placeholder: 'Создание современных веб-приложений',
                            rules: [
                                { type: 'required', field: 'card1_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[0] ? block.props.cards[0].text : 'Создание современных веб-приложений'
                        },
                        {
                            field: 'card1_button',
                            label: 'Карточка 1 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Подробнее',
                            rules: [
                                { type: 'required', field: 'card1_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[0] ? block.props.cards[0].button : 'Подробнее'
                        },
                        {
                            field: 'card1_link',
                            label: 'Карточка 1 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card1_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[0] ? block.props.cards[0].link : 'https://example.com'
                        },
                        {
                            field: 'card1_image',
                            label: 'Карточка 1 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card1_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[0] ? block.props.cards[0].image : 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'card2_title',
                            label: 'Карточка 2 - Заголовок',
                            type: 'text',
                            placeholder: 'Мобильные приложения',
                            rules: [
                                { type: 'required', field: 'card2_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[1] ? block.props.cards[1].title : 'Мобильные приложения'
                        },
                        {
                            field: 'card2_text',
                            label: 'Карточка 2 - Описание',
                            type: 'textarea',
                            placeholder: 'Разработка мобильных приложений для iOS и Android',
                            rules: [
                                { type: 'required', field: 'card2_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[1] ? block.props.cards[1].text : 'Разработка мобильных приложений для iOS и Android'
                        },
                        {
                            field: 'card2_button',
                            label: 'Карточка 2 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Узнать больше',
                            rules: [
                                { type: 'required', field: 'card2_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[1] ? block.props.cards[1].button : 'Узнать больше'
                        },
                        {
                            field: 'card2_link',
                            label: 'Карточка 2 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card2_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[1] ? block.props.cards[1].link : 'https://example.com'
                        },
                        {
                            field: 'card2_image',
                            label: 'Карточка 2 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card2_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[1] ? block.props.cards[1].image : 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'card3_title',
                            label: 'Карточка 3 - Заголовок',
                            type: 'text',
                            placeholder: 'Дизайн',
                            rules: [
                                { type: 'required', field: 'card3_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[2] ? block.props.cards[2].title : 'Дизайн'
                        },
                        {
                            field: 'card3_text',
                            label: 'Карточка 3 - Описание',
                            type: 'textarea',
                            placeholder: 'Создание уникального дизайна для вашего бренда',
                            rules: [
                                { type: 'required', field: 'card3_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[2] ? block.props.cards[2].text : 'Создание уникального дизайна для вашего бренда'
                        },
                        {
                            field: 'card3_button',
                            label: 'Карточка 3 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Посмотреть работы',
                            rules: [
                                { type: 'required', field: 'card3_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[2] ? block.props.cards[2].button : 'Посмотреть работы'
                        },
                        {
                            field: 'card3_link',
                            label: 'Карточка 3 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card3_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[2] ? block.props.cards[2].link : 'https://example.com'
                        },
                        {
                            field: 'card3_image',
                            label: 'Карточка 3 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card3_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: block.props.cards && block.props.cards[2] ? block.props.cards[2].image : 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'cardBackground',
                            label: 'Цвет фона карточек',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'cardBackground', message: 'Цвет фона обязателен' }
                            ],
                            defaultValue: block.settings.cardBackground || '#ffffff'
                        },
                        {
                            field: 'cardTextColor',
                            label: 'Цвет текста карточек',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'cardTextColor', message: 'Цвет текста обязателен' }
                            ],
                            defaultValue: block.settings.cardTextColor || '#333333'
                        },
                        {
                            field: 'cardBorderRadius',
                            label: 'Скругление карточек',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'cardBorderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'cardBorderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: parseInt(block.settings.cardBorderRadius) || 8
                        },
                        {
                            field: 'columns',
                            label: 'Количество колонок',
                            type: 'select',
                            options: [
                                { value: '1', label: '1 колонка' },
                                { value: '2', label: '2 колонки' },
                                { value: '3', label: '3 колонки' },
                                { value: '4', label: '4 колонки' }
                            ],
                            rules: [
                                { type: 'required', field: 'columns', message: 'Количество колонок обязательно' }
                            ],
                            defaultValue: String(block.settings.columns || '3')
                        },
                        {
                            field: 'gap',
                            label: 'Отступ между карточками',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'gap', value: 0, message: 'Отступ не может быть отрицательным' },
                                { type: 'max', field: 'gap', value: 50, message: 'Максимальный отступ: 50px' }
                            ],
                            defaultValue: parseInt(block.settings.gap) || 16
                        }
                    ],
                    submitButtonText: 'Сохранить изменения',
                    cancelButtonText: 'Отмена'
                }
            };

            const config = formConfigs[block.type];
            if (!config) {
                log(`Неизвестный тип блока для редактирования: ${block.type}`, 'error');
                return;
            }

            // Создаем модальное окно
            const modal = document.createElement('div');
            modal.className = 'form-modal';
            modal.innerHTML = `
                <div class="form-dialog-overlay">
                    <div class="form-dialog">
                        <div class="form-dialog-header">
                            <h3>${config.title}</h3>
                            <button class="close-btn" onclick="this.closest('.form-dialog-overlay').remove()">×</button>
                        </div>
                        <div class="form-dialog-content">
                            <p class="form-description">${config.description}</p>
                            <div id="form-container"></div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Генерируем форму
            const formContainer = modal.querySelector('#form-container');
            const formHtml = generateFormHTML(config, (data) => {
                updateBlockFromFormData(blockId, data);
                modal.remove();
            });
            formContainer.innerHTML = formHtml;
        };

        window.deleteBlock = function(blockId) {
            if (confirm('Удалить этот блок?')) {
                blocks = blocks.filter(b => b.id !== blockId);
                if (selectedBlockId === blockId) {
                    selectedBlockId = null;
                }
                updateStats();
                renderBlocks();
                log(`Блок удален: ${blockId}`, 'error');
            }
        };

        window.moveBlockUp = function(blockId) {
            const index = blocks.findIndex(b => b.id === blockId);
            if (index > 0) {
                const block = blocks.splice(index, 1)[0];
                blocks.splice(index - 1, 0, block);
                renderBlocks();
                log(`Блок перемещен вверх: ${blockId}`, 'info');
            }
        };

        window.moveBlockDown = function(blockId) {
            const index = blocks.findIndex(b => b.id === blockId);
            if (index < blocks.length - 1) {
                const block = blocks.splice(index, 1)[0];
                blocks.splice(index + 1, 0, block);
                renderBlocks();
                log(`Блок перемещен вниз: ${blockId}`, 'info');
            }
        };

        window.toggleBlockVisibility = function(blockId) {
            const block = blocks.find(b => b.id === blockId);
            if (block) {
                block.setVisible(!block.visible);
                renderBlocks();
                log(`Видимость блока изменена: ${block.visible}`, 'info');
            }
        };

        window.toggleBlockLock = function(blockId) {
            const block = blocks.find(b => b.id === blockId);
            if (block) {
                block.setLocked(!block.locked);
                renderBlocks();
                log(`Блокировка блока изменена: ${block.locked}`, 'info');
            }
        };

        function updateBlockFromFormData(blockId, data) {
            const block = blocks.find(b => b.id === blockId);
            if (!block) return;

            switch (block.type) {
                case 'text':
                    block.settings = {
                        fontSize: data.fontSize + 'px',
                        color: data.color
                    };
                    block.props = {
                        content: data.content,
                        textAlign: data.textAlign
                    };
                    block.template = `<div style="text-align: ${data.textAlign}; font-size: ${data.fontSize}px; color: ${data.color}; padding: 10px;">${data.content}</div>`;
                    break;
                case 'image':
                    block.settings = {
                        borderRadius: data.borderRadius + 'px'
                    };
                    block.props = {
                        src: data.src,
                        alt: data.alt
                    };
                    block.template = `<img src="${data.src}" alt="${data.alt}" style="border-radius: ${data.borderRadius}px; width: 100%; height: 100%; object-fit: cover;" />`;
                    break;
                case 'button':
                    block.settings = {
                        backgroundColor: data.backgroundColor,
                        color: data.color,
                        borderRadius: data.borderRadius + 'px',
                        padding: data.padding
                    };
                    block.props = {
                        text: data.text,
                        onClick: data.onClick
                    };
                    block.template = `<button onclick="${data.onClick}" style="background-color: ${data.backgroundColor}; color: ${data.color}; border-radius: ${data.borderRadius}px; padding: ${data.padding}; border: none; cursor: pointer; transition: all 0.2s;">${data.text}</button>`;
                    break;
                case 'cardlist':
                    const cards = [
                        {
                            title: data.card1_title,
                            text: data.card1_text,
                            button: data.card1_button,
                            link: data.card1_link,
                            image: data.card1_image
                        },
                        {
                            title: data.card2_title,
                            text: data.card2_text,
                            button: data.card2_button,
                            link: data.card2_link,
                            image: data.card2_image
                        },
                        {
                            title: data.card3_title,
                            text: data.card3_text,
                            button: data.card3_button,
                            link: data.card3_link,
                            image: data.card3_image
                        }
                    ];
                    
                    const cardsHtml = cards.map(card => 
                        `<div class="card-item" style="background: ${data.cardBackground}; color: ${data.cardTextColor}; border-radius: ${data.cardBorderRadius}px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; border: 2px solid #e9ecef; cursor: pointer;" onclick="showCardModal(this)">
                            <div class="card-image" style="margin-bottom: 15px;">
                                <img src="${card.image}" alt="${card.title}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;" />
                            </div>
                            <h3 style="margin: 0 0 10px 0; font-size: 18px; font-weight: 600;">${card.title}</h3>
                            <p style="margin: 0 0 15px 0; opacity: 0.8; line-height: 1.5;">${card.text}</p>
                            <a href="${card.link}" target="_blank" style="display: inline-block; background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">${card.button}</a>
                        </div>`
                    ).join('');
                    
                    block.settings = {
                        cardBackground: data.cardBackground,
                        cardTextColor: data.cardTextColor,
                        cardBorderRadius: data.cardBorderRadius + 'px',
                        columns: data.columns,
                        gap: data.gap + 'px'
                    };
                    block.props = {
                        title: data.title,
                        cards: cards
                    };
                    block.template = `
                        <div class="card-list-container" style="margin: 20px 0;">
                            <h2 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 28px; font-weight: 700;">${data.title}</h2>
                            <div class="card-grid" style="display: grid; grid-template-columns: repeat(${data.columns}, 1fr); gap: ${data.gap}px;">
                                ${cardsHtml}
                            </div>
                        </div>
                    `;
                    break;
            }

            renderBlocks();
            log(`Блок обновлен: ${blockId}`, 'success');
        }

        // Функция drag & drop удалена - блоки теперь располагаются как секции сайта

        // Функция для закрытия модальных окон
        window.closeModal = function(button) {
            const modal = button.closest('.form-modal');
            if (modal) {
                modal.remove();
            }
        };

        // Функции для работы с формами
        window.showCreateForm = function(blockType) {
            const formConfigs = {
                'text': {
                    title: 'Настройка текстового блока',
                    description: 'Настройте параметры текстового блока',
                    fields: [
                        {
                            field: 'content',
                            label: 'Текст',
                            type: 'textarea',
                            placeholder: 'Введите текст...',
                            rules: [
                                { type: 'required', field: 'content', message: 'Текст обязателен для заполнения' },
                                { type: 'minLength', field: 'content', value: 1, message: 'Текст не может быть пустым' }
                            ],
                            defaultValue: ''
                        },
                        {
                            field: 'fontSize',
                            label: 'Размер шрифта',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'fontSize', message: 'Размер шрифта обязателен' },
                                { type: 'min', field: 'fontSize', value: 8, message: 'Минимальный размер шрифта: 8px' },
                                { type: 'max', field: 'fontSize', value: 72, message: 'Максимальный размер шрифта: 72px' }
                            ],
                            defaultValue: 16
                        },
                        {
                            field: 'color',
                            label: 'Цвет текста',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'color', message: 'Цвет обязателен' }
                            ],
                            defaultValue: '#333333'
                        },
                        {
                            field: 'textAlign',
                            label: 'Выравнивание',
                            type: 'select',
                            options: [
                                { value: 'left', label: 'По левому краю' },
                                { value: 'center', label: 'По центру' },
                                { value: 'right', label: 'По правому краю' },
                                { value: 'justify', label: 'По ширине' }
                            ],
                            rules: [
                                { type: 'required', field: 'textAlign', message: 'Выравнивание обязательно' }
                            ],
                            defaultValue: 'left'
                        }
                    ],
                    submitButtonText: 'Создать блок',
                    cancelButtonText: 'Отмена'
                },
                'image': {
                    title: 'Настройка блока изображения',
                    description: 'Настройте параметры блока изображения',
                    fields: [
                        {
                            field: 'src',
                            label: 'URL изображения',
                            type: 'url',
                            placeholder: 'https://example.com/image.jpg',
                            rules: [
                                { type: 'required', field: 'src', message: 'URL изображения обязателен' },
                                { type: 'url', field: 'src', message: 'Введите корректный URL' }
                            ],
                            defaultValue: ''
                        },
                        {
                            field: 'alt',
                            label: 'Альтернативный текст',
                            type: 'text',
                            placeholder: 'Описание изображения',
                            rules: [
                                { type: 'required', field: 'alt', message: 'Альтернативный текст обязателен' }
                            ],
                            defaultValue: ''
                        },
                        {
                            field: 'borderRadius',
                            label: 'Скругление углов',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'borderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'borderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: 0
                        },
                        {
                            field: 'width',
                            label: 'Ширина',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'width', message: 'Ширина обязательна' },
                                { type: 'min', field: 'width', value: 50, message: 'Минимальная ширина: 50px' },
                                { type: 'max', field: 'width', value: 1200, message: 'Максимальная ширина: 1200px' }
                            ],
                            defaultValue: 300
                        },
                        {
                            field: 'height',
                            label: 'Высота',
                            type: 'number',
                            rules: [
                                { type: 'required', field: 'height', message: 'Высота обязательна' },
                                { type: 'min', field: 'height', value: 50, message: 'Минимальная высота: 50px' },
                                { type: 'max', field: 'height', value: 800, message: 'Максимальная высота: 800px' }
                            ],
                            defaultValue: 200
                        }
                    ],
                    submitButtonText: 'Создать блок',
                    cancelButtonText: 'Отмена'
                },
                'button': {
                    title: 'Настройка кнопки',
                    description: 'Настройте параметры кнопки',
                    fields: [
                        {
                            field: 'text',
                            label: 'Текст кнопки',
                            type: 'text',
                            placeholder: 'Нажми меня',
                            rules: [
                                { type: 'required', field: 'text', message: 'Текст кнопки обязателен' },
                                { type: 'minLength', field: 'text', value: 1, message: 'Текст не может быть пустым' }
                            ],
                            defaultValue: 'Кнопка'
                        },
                        {
                            field: 'backgroundColor',
                            label: 'Цвет фона',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'backgroundColor', message: 'Цвет фона обязателен' }
                            ],
                            defaultValue: '#007bff'
                        },
                        {
                            field: 'color',
                            label: 'Цвет текста',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'color', message: 'Цвет текста обязателен' }
                            ],
                            defaultValue: '#ffffff'
                        },
                        {
                            field: 'borderRadius',
                            label: 'Скругление углов',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'borderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'borderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: 4
                        },
                        {
                            field: 'padding',
                            label: 'Отступы',
                            type: 'text',
                            placeholder: '8px 16px',
                            rules: [
                                { type: 'required', field: 'padding', message: 'Отступы обязательны' }
                            ],
                            defaultValue: '8px 16px'
                        },
                        {
                            field: 'onClick',
                            label: 'Обработчик клика',
                            type: 'text',
                            placeholder: 'alert("Привет!")',
                            rules: [
                                { type: 'required', field: 'onClick', message: 'Обработчик клика обязателен' }
                            ],
                            defaultValue: 'alert("Привет!")'
                        }
                    ],
                    submitButtonText: 'Создать кнопку',
                    cancelButtonText: 'Отмена'
                },
                'cardlist': {
                    title: 'Настройка списка карточек',
                    description: 'Настройте параметры списка карточек',
                    fields: [
                        {
                            field: 'title',
                            label: 'Заголовок списка',
                            type: 'text',
                            placeholder: 'Наши услуги',
                            rules: [
                                { type: 'required', field: 'title', message: 'Заголовок обязателен' },
                                { type: 'minLength', field: 'title', value: 1, message: 'Заголовок не может быть пустым' }
                            ],
                            defaultValue: 'Наши услуги'
                        },
                        {
                            field: 'card1_title',
                            label: 'Карточка 1 - Заголовок',
                            type: 'text',
                            placeholder: 'Веб-разработка',
                            rules: [
                                { type: 'required', field: 'card1_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: 'Веб-разработка'
                        },
                        {
                            field: 'card1_text',
                            label: 'Карточка 1 - Описание',
                            type: 'textarea',
                            placeholder: 'Создание современных веб-приложений',
                            rules: [
                                { type: 'required', field: 'card1_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: 'Создание современных веб-приложений'
                        },
                        {
                            field: 'card1_button',
                            label: 'Карточка 1 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Подробнее',
                            rules: [
                                { type: 'required', field: 'card1_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: 'Подробнее'
                        },
                        {
                            field: 'card1_link',
                            label: 'Карточка 1 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card1_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: 'https://example.com'
                        },
                        {
                            field: 'card1_image',
                            label: 'Карточка 1 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card1_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'card2_title',
                            label: 'Карточка 2 - Заголовок',
                            type: 'text',
                            placeholder: 'Мобильные приложения',
                            rules: [
                                { type: 'required', field: 'card2_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: 'Мобильные приложения'
                        },
                        {
                            field: 'card2_text',
                            label: 'Карточка 2 - Описание',
                            type: 'textarea',
                            placeholder: 'Разработка мобильных приложений для iOS и Android',
                            rules: [
                                { type: 'required', field: 'card2_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: 'Разработка мобильных приложений для iOS и Android'
                        },
                        {
                            field: 'card2_button',
                            label: 'Карточка 2 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Узнать больше',
                            rules: [
                                { type: 'required', field: 'card2_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: 'Узнать больше'
                        },
                        {
                            field: 'card2_link',
                            label: 'Карточка 2 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card2_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: 'https://example.com'
                        },
                        {
                            field: 'card2_image',
                            label: 'Карточка 2 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card2_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'card3_title',
                            label: 'Карточка 3 - Заголовок',
                            type: 'text',
                            placeholder: 'Дизайн',
                            rules: [
                                { type: 'required', field: 'card3_title', message: 'Заголовок карточки обязателен' }
                            ],
                            defaultValue: 'Дизайн'
                        },
                        {
                            field: 'card3_text',
                            label: 'Карточка 3 - Описание',
                            type: 'textarea',
                            placeholder: 'Создание уникального дизайна для вашего бренда',
                            rules: [
                                { type: 'required', field: 'card3_text', message: 'Описание карточки обязательно' }
                            ],
                            defaultValue: 'Создание уникального дизайна для вашего бренда'
                        },
                        {
                            field: 'card3_button',
                            label: 'Карточка 3 - Текст кнопки',
                            type: 'text',
                            placeholder: 'Посмотреть работы',
                            rules: [
                                { type: 'required', field: 'card3_button', message: 'Текст кнопки обязателен' }
                            ],
                            defaultValue: 'Посмотреть работы'
                        },
                        {
                            field: 'card3_link',
                            label: 'Карточка 3 - Ссылка',
                            type: 'url',
                            placeholder: 'https://example.com',
                            rules: [
                                { type: 'required', field: 'card3_link', message: 'Ссылка обязательна' }
                            ],
                            defaultValue: 'https://example.com'
                        },
                        {
                            field: 'card3_image',
                            label: 'Карточка 3 - Изображение',
                            type: 'url',
                            placeholder: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg',
                            rules: [
                                { type: 'required', field: 'card3_image', message: 'Изображение обязательно' }
                            ],
                            defaultValue: 'https://i.pinimg.com/736x/ca/9a/12/ca9a123b7269fba0574726629bad42b9.jpg'
                        },
                        {
                            field: 'cardBackground',
                            label: 'Цвет фона карточек',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'cardBackground', message: 'Цвет фона обязателен' }
                            ],
                            defaultValue: '#ffffff'
                        },
                        {
                            field: 'cardTextColor',
                            label: 'Цвет текста карточек',
                            type: 'color',
                            rules: [
                                { type: 'required', field: 'cardTextColor', message: 'Цвет текста обязателен' }
                            ],
                            defaultValue: '#333333'
                        },
                        {
                            field: 'cardBorderRadius',
                            label: 'Скругление карточек',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'cardBorderRadius', value: 0, message: 'Скругление не может быть отрицательным' },
                                { type: 'max', field: 'cardBorderRadius', value: 50, message: 'Максимальное скругление: 50px' }
                            ],
                            defaultValue: 8
                        },
                        {
                            field: 'columns',
                            label: 'Количество колонок',
                            type: 'select',
                            options: [
                                { value: '1', label: '1 колонка' },
                                { value: '2', label: '2 колонки' },
                                { value: '3', label: '3 колонки' },
                                { value: '4', label: '4 колонки' }
                            ],
                            rules: [
                                { type: 'required', field: 'columns', message: 'Количество колонок обязательно' }
                            ],
                            defaultValue: '3'
                        },
                        {
                            field: 'gap',
                            label: 'Отступ между карточками',
                            type: 'number',
                            rules: [
                                { type: 'min', field: 'gap', value: 0, message: 'Отступ не может быть отрицательным' },
                                { type: 'max', field: 'gap', value: 50, message: 'Максимальный отступ: 50px' }
                            ],
                            defaultValue: 16
                        }
                    ],
                    submitButtonText: 'Создать список карточек',
                    cancelButtonText: 'Отмена'
                }
            };

            const config = formConfigs[blockType];
            if (!config) {
                log(`Неизвестный тип блока: ${blockType}`, 'error');
                return;
            }

            // Удаляем существующие модальные окна
            const existingModals = document.querySelectorAll('.form-modal');
            existingModals.forEach(modal => modal.remove());

            // Создаем модальное окно
            const modal = document.createElement('div');
            modal.className = 'form-modal';
            modal.innerHTML = `
                <div class="form-dialog-overlay">
                    <div class="form-dialog">
                        <div class="form-dialog-header">
                            <h3>${config.title}</h3>
                            <button class="close-btn" onclick="closeModal(this)">×</button>
                        </div>
                        <div class="form-dialog-content">
                            <p class="form-description">${config.description}</p>
                            <div id="form-container"></div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Добавляем обработчик клика по overlay
            const overlay = modal.querySelector('.form-dialog-overlay');
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    modal.remove();
                }
            });

            // Генерируем форму
            const formContainer = modal.querySelector('#form-container');
            const formHtml = generateFormHTML(config, (data) => {
                createBlockFromFormData(blockType, data);
                modal.remove();
            });
            formContainer.innerHTML = formHtml;
        };

        function generateFormHTML(config, onSubmit) {
            const formId = `form_${Date.now()}`;
            
            let html = `
                <form id="${formId}" class="naberika-form">
                    <div class="form-fields">
            `;

            let currentCard = null;
            let cardSectionOpen = false;

            for (const field of config.fields) {
                // Проверяем, начинается ли новая карточка
                const cardMatch = field.field.match(/^card(\d+)_/);
                
                if (cardMatch) {
                    const cardNumber = cardMatch[1];
                    
                    // Если это новая карточка, закрываем предыдущую секцию и открываем новую
                    if (currentCard !== cardNumber) {
                        if (cardSectionOpen) {
                            html += `</div>`;
                        }
                        html += `<div class="card-section"><h4>Карточка ${cardNumber}</h4>`;
                        currentCard = cardNumber;
                        cardSectionOpen = true;
                    }
                } else {
                    // Если это не поле карточки, закрываем секцию карточки если она открыта
                    if (cardSectionOpen) {
                        html += `</div>`;
                        cardSectionOpen = false;
                        currentCard = null;
                    }
                }
                
                html += generateFieldHTML(field);
            }

            // Закрываем последнюю секцию карточки если она осталась открытой
            if (cardSectionOpen) {
                html += `</div>`;
            }

            html += `
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">${config.submitButtonText}</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal(this)">${config.cancelButtonText}</button>
                    </div>
                </form>
            `;

            // Добавляем обработчик формы
            setTimeout(() => {
                const form = document.getElementById(formId);
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleFormSubmit(e, config.fields, onSubmit);
                    });
                }
            }, 0);

            return html;
        }

        function generateFieldHTML(field) {
            const fieldId = `field_${field.field}`;
            
            switch (field.type) {
                case 'textarea':
                    return `
                        <div class="form-group">
                            <label for="${fieldId}">${field.label}</label>
                            <textarea id="${fieldId}" name="${field.field}" placeholder="${field.placeholder || ''}" class="form-control">${field.defaultValue || ''}</textarea>
                            <div class="field-errors" id="errors_${field.field}"></div>
                        </div>
                    `;
                case 'select':
                    const options = field.options?.map(opt => {
                        const isSelected = opt.value === field.defaultValue || 
                                        String(opt.value) === String(field.defaultValue);
                        return `<option value="${opt.value}" ${isSelected ? 'selected' : ''}>${opt.label}</option>`;
                    }).join('') || '';
                    return `
                        <div class="form-group">
                            <label for="${fieldId}">${field.label}</label>
                            <select id="${fieldId}" name="${field.field}" class="form-control">
                                <option value="">Выберите...</option>
                                ${options}
                            </select>
                            <div class="field-errors" id="errors_${field.field}"></div>
                        </div>
                    `;
                case 'checkbox':
                    return `
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="${fieldId}" name="${field.field}" ${field.defaultValue ? 'checked' : ''} class="form-checkbox" />
                                ${field.label}
                            </label>
                            <div class="field-errors" id="errors_${field.field}"></div>
                        </div>
                    `;
                case 'color':
                    return `
                        <div class="form-group">
                            <label for="${fieldId}">${field.label}</label>
                            <input type="color" id="${fieldId}" name="${field.field}" value="${field.defaultValue || '#000000'}" class="form-control" />
                            <div class="field-errors" id="errors_${field.field}"></div>
                        </div>
                    `;
                default:
                    return `
                        <div class="form-group">
                            <label for="${fieldId}">${field.label}</label>
                            <input type="${field.type}" id="${fieldId}" name="${field.field}" placeholder="${field.placeholder || ''}" value="${field.defaultValue || ''}" class="form-control" />
                            <div class="field-errors" id="errors_${field.field}"></div>
                        </div>
                    `;
            }
        }

        function handleFormSubmit(event, fields, onSubmit) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Валидация
            let isValid = true;
            for (const field of fields) {
                const value = data[field.field];
                const errors = validateField(field, value);
                
                if (errors.length > 0) {
                    showFieldErrors(field.field, errors);
                    isValid = false;
                } else {
                    clearFieldErrors(field.field);
                }
            }
            
            if (isValid) {
                onSubmit(data);
            }
        }

        // Импорт универсальной валидации (в реальном проекте)
        // import { UniversalValidator } from '../utils/universalValidation.js';
        
        // Локальная копия валидатора для демонстрации
        const UniversalValidator = {
            validateField: function(value, rules) {
                const errors = [];
                
                for (const rule of rules) {
                    switch (rule.type) {
                        case 'required':
                            if (value === null || value === undefined || value === '') {
                                errors.push(rule.message);
                            }
                            break;
                        case 'email':
                            if (value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
                                errors.push(rule.message);
                            }
                            break;
                        case 'url':
                            if (value) {
                                try {
                                    new URL(value);
                                } catch {
                                    errors.push(rule.message);
                                }
                            }
                            break;
                        case 'min':
                            if (value !== null && value !== undefined && parseFloat(value) < rule.value) {
                                errors.push(rule.message);
                            }
                            break;
                        case 'max':
                            if (value !== null && value !== undefined && parseFloat(value) > rule.value) {
                                errors.push(rule.message);
                            }
                            break;
                        case 'minLength':
                            if (value && value.length < rule.value) {
                                errors.push(rule.message);
                            }
                            break;
                        case 'maxLength':
                            if (value && value.length > rule.value) {
                                errors.push(rule.message);
                            }
                            break;
                    }
                }
                
                return errors;
            }
        };

        function validateField(field, value) {
            return UniversalValidator.validateField(value, field.rules);
        }

        function showFieldErrors(fieldName, errors) {
            const errorContainer = document.getElementById('errors_' + fieldName);
            if (errorContainer) {
                errorContainer.innerHTML = errors.map(error => `<div class="error">${error}</div>`).join('');
            }
            
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.classList.add('error');
            }
        }

        function clearFieldErrors(fieldName) {
            const errorContainer = document.getElementById('errors_' + fieldName);
            if (errorContainer) {
                errorContainer.innerHTML = '';
            }
            
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field) {
                field.classList.remove('error');
            }
        }

        function createBlockFromFormData(blockType, data) {
            const block = new SimpleBlock({
                type: blockType,
                settings: {},
                props: {},
                template: '',
                visible: true,
                locked: false
            });

            switch (blockType) {
                case 'text':
                    block.settings = {
                        fontSize: data.fontSize + 'px',
                        color: data.color
                    };
                    block.props = {
                        content: data.content,
                        textAlign: data.textAlign
                    };
                    block.template = `<div style="text-align: ${data.textAlign}; font-size: ${data.fontSize}px; color: ${data.color}; padding: 10px;">${data.content}</div>`;
                    break;
                case 'image':
                    block.settings = {
                        borderRadius: data.borderRadius + 'px'
                    };
                    block.props = {
                        src: data.src,
                        alt: data.alt
                    };
                    block.template = `<img src="${data.src}" alt="${data.alt}" style="border-radius: ${data.borderRadius}px; width: 100%; height: 100%; object-fit: cover;" />`;
                    break;
                case 'button':
                    block.settings = {
                        backgroundColor: data.backgroundColor,
                        color: data.color,
                        borderRadius: data.borderRadius + 'px',
                        padding: data.padding
                    };
                    block.props = {
                        text: data.text,
                        onClick: data.onClick
                    };
                    block.template = `<button onclick="${data.onClick}" style="background-color: ${data.backgroundColor}; color: ${data.color}; border-radius: ${data.borderRadius}px; padding: ${data.padding}; border: none; cursor: pointer; transition: all 0.2s;">${data.text}</button>`;
                    break;
                case 'cardlist':
                    const cards = [
                        {
                            title: data.card1_title,
                            text: data.card1_text,
                            button: data.card1_button,
                            link: data.card1_link,
                            image: data.card1_image
                        },
                        {
                            title: data.card2_title,
                            text: data.card2_text,
                            button: data.card2_button,
                            link: data.card2_link,
                            image: data.card2_image
                        },
                        {
                            title: data.card3_title,
                            text: data.card3_text,
                            button: data.card3_button,
                            link: data.card3_link,
                            image: data.card3_image
                        }
                    ];
                    
                    const cardsHtml = cards.map(card => 
                        `<div class="card-item" style="background: ${data.cardBackground}; color: ${data.cardTextColor}; border-radius: ${data.cardBorderRadius}px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; border: 2px solid #e9ecef; cursor: pointer;" onclick="showCardModal(this)">
                            <div class="card-image" style="margin-bottom: 15px;">
                                <img src="${card.image}" alt="${card.title}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px;" />
                            </div>
                            <h3 style="margin: 0 0 10px 0; font-size: 18px; font-weight: 600;">${card.title}</h3>
                            <p style="margin: 0 0 15px 0; opacity: 0.8; line-height: 1.5;">${card.text}</p>
                            <a href="${card.link}" target="_blank" style="display: inline-block; background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px; transition: background 0.2s;">${card.button}</a>
                        </div>`
                    ).join('');
                    
                    block.settings = {
                        cardBackground: data.cardBackground,
                        cardTextColor: data.cardTextColor,
                        cardBorderRadius: data.cardBorderRadius + 'px',
                        columns: data.columns,
                        gap: data.gap + 'px'
                    };
                    block.props = {
                        title: data.title,
                        cards: cards
                    };
                    block.template = `
                        <div class="card-list-container" style="margin: 20px 0;">
                            <h2 style="text-align: center; margin-bottom: 30px; color: #333; font-size: 28px; font-weight: 700;">${data.title}</h2>
                            <div class="card-grid" style="display: grid; grid-template-columns: repeat(${data.columns}, 1fr); gap: ${data.gap}px;">
                                ${cardsHtml}
                            </div>
                        </div>
                    `;
                    break;
            }

            blocks.push(block);
            selectBlock(block.id);
            updateStats();
            renderBlocks();
            log(`Добавлен блок ${blockType}: ${block.id}`, 'success');
        }

        // Функции для добавления блоков (старые методы для обратной совместимости)
        window.addTextBlock = function() {
            const block = new SimpleBlock({
                type: 'text',
                settings: {
                    fontSize: '16px',
                    color: '#333',
                    backgroundColor: '#f8f9fa',
                    padding: '10px',
                    borderRadius: '4px',
                    border: '1px solid #dee2e6'
                },
                props: {
                    content: 'Текстовый блок',
                    textAlign: 'center'
                },
                template: '<div style="text-align: {{ props.textAlign }}; font-size: {{ settings.fontSize }}; color: {{ settings.color }};">{{ props.content }}</div>',
            });

            blocks.push(block);
            selectBlock(block.id);
            updateStats();
            renderBlocks();
            log(`Добавлен текстовый блок: ${block.id}`, 'success');
        };

        window.addImageBlock = function() {
            const block = new SimpleBlock({
                type: 'image',
                settings: {
                    border: '2px solid #007bff',
                    borderRadius: '8px',
                    overflow: 'hidden'
                },
                props: {
                    src: 'https://via.placeholder.com/200x150/007bff/ffffff?text=Image',
                    alt: 'Placeholder Image'
                },
                template: '<img src="{{ props.src }}" alt="{{ props.alt }}" style="width: 100%; height: 100%; object-fit: cover;">',
            });

            blocks.push(block);
            selectBlock(block.id);
            updateStats();
            renderBlocks();
            log(`Добавлен блок изображения: ${block.id}`, 'success');
        };

        window.addButtonBlock = function() {
            const block = new SimpleBlock({
                type: 'button',
                settings: {
                    backgroundColor: '#007bff',
                    color: 'white',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600'
                },
                props: {
                    text: 'Нажми меня!',
                    variant: 'primary'
                },
                template: '<button style="width: 100%; height: 100%; background-color: {{ settings.backgroundColor }}; color: {{ settings.color }}; border: {{ settings.border }}; border-radius: {{ settings.borderRadius }}; cursor: {{ settings.cursor }}; font-size: {{ settings.fontSize }}; font-weight: {{ settings.fontWeight }};">{{ props.text }}</button>',
            });

            blocks.push(block);
            selectBlock(block.id);
            updateStats();
            renderBlocks();
            log(`Добавлена кнопка: ${block.id}`, 'success');
        };

        window.addContainerBlock = function() {
            const block = new SimpleBlock({
                type: 'container',
                settings: {
                    backgroundColor: '#f8f9fa',
                    border: '2px dashed #6c757d',
                    borderRadius: '8px',
                    padding: '20px'
                },
                props: {
                    title: 'Контейнер',
                    content: 'Это контейнер для других блоков'
                },
                template: '<div style="text-align: center;"><h3 style="margin: 0 0 10px 0; color: #333;">{{ props.title }}</h3><p style="margin: 0; color: #666;">{{ props.content }}</p></div>',
            });

            blocks.push(block);
            selectBlock(block.id);
            updateStats();
            renderBlocks();
            log(`Добавлен контейнер: ${block.id}`, 'success');
        };

        window.clearAllBlocks = function() {
            blocks = [];
            selectedBlockId = null;
            updateStats();
            renderBlocks();
            log('Все блоки удалены', 'warning');
        };

        // Обработчики клавиатуры
        document.addEventListener('keydown', (e) => {
            if (selectedBlockId) {
                const block = blocks.find(b => b.id === selectedBlockId);
                if (!block) return;

                switch(e.key) {
                    case 'Delete':
                    case 'Backspace':
                        blocks = blocks.filter(b => b.id !== selectedBlockId);
                        selectedBlockId = null;
                        updateStats();
                        renderBlocks();
                        log('Блок удален', 'error');
                        break;
                    case 'l':
                    case 'L':
                        block.setLocked(!block.locked);
                        renderBlocks();
                        log(`Блокировка изменена: ${block.locked}`, 'info');
                        break;
                    case 'h':
                    case 'H':
                        block.setVisible(!block.visible);
                        renderBlocks();
                        log(`Видимость изменена: ${block.visible}`, 'info');
                        break;
                }
            }
        });

        // Функция для показа модального окна карточки
        window.showCardModal = function(cardElement) {
            const title = cardElement.querySelector('h3')?.textContent || '';
            const text = cardElement.querySelector('p')?.textContent || '';
            const button = cardElement.querySelector('a')?.textContent || '';
            const link = cardElement.querySelector('a')?.getAttribute('href') || '';
            const image = cardElement.querySelector('img')?.getAttribute('src') || '';
            
            const card = { title, text, button, link, image };
            
            // Создаем модальное окно
            const modal = document.createElement('div');
            modal.className = 'card-modal-overlay';
            modal.innerHTML = `
                <div class="card-modal-content">
                    <div class="card-modal-header">
                        <h3>${card.title}</h3>
                        <button class="card-modal-close" onclick="this.closest('.card-modal-overlay').remove()">×</button>
                    </div>
                    <div class="card-modal-body">
                        <div class="card-modal-image">
                            <img src="${card.image}" alt="${card.title}" />
                        </div>
                        <div class="card-modal-details">
                            <h4>${card.title}</h4>
                            <p>${card.text}</p>
                            <a href="${card.link}" target="_blank" class="card-modal-button">${card.button}</a>
                        </div>
                    </div>
                </div>
            `;
            
            // Добавляем стили для модального окна
            const style = document.createElement('style');
            style.textContent = `
                .card-modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.6);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    backdrop-filter: blur(4px);
                }
                .card-modal-content {
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                    max-width: 600px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    animation: modalSlideIn 0.3s ease-out;
                }
                @keyframes modalSlideIn {
                    from { opacity: 0; transform: scale(0.9) translateY(-20px); }
                    to { opacity: 1; transform: scale(1) translateY(0); }
                }
                .card-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px 24px;
                    border-bottom: 1px solid #e9ecef;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border-radius: 12px 12px 0 0;
                }
                .card-modal-header h3 {
                    margin: 0;
                    font-size: 1.5rem;
                    font-weight: 600;
                }
                .card-modal-close {
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: white;
                    padding: 0;
                    width: 32px;
                    height: 32px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    transition: all 0.2s;
                }
                .card-modal-close:hover {
                    background: rgba(255, 255, 255, 0.2);
                    transform: scale(1.1);
                }
                .card-modal-body {
                    padding: 24px;
                }
                .card-modal-image {
                    margin-bottom: 20px;
                    border-radius: 8px;
                    overflow: hidden;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }
                .card-modal-image img {
                    width: 100%;
                    height: 200px;
                    object-fit: cover;
                    display: block;
                }
                .card-modal-details h4 {
                    margin: 0 0 12px 0;
                    font-size: 1.25rem;
                    font-weight: 600;
                    color: #333;
                }
                .card-modal-details p {
                    margin: 0 0 20px 0;
                    color: #666;
                    line-height: 1.6;
                    font-size: 1rem;
                }
                .card-modal-button {
                    display: inline-block;
                    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                    color: white;
                    padding: 12px 24px;
                    text-decoration: none;
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
                }
                .card-modal-button:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
                    text-decoration: none;
                    color: white;
                }
                @media (max-width: 768px) {
                    .card-modal-content { width: 95%; margin: 20px; }
                    .card-modal-header { padding: 16px 20px; }
                    .card-modal-header h3 { font-size: 1.25rem; }
                    .card-modal-body { padding: 20px; }
                    .card-modal-image img { height: 150px; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(modal);
            
            // Закрытие по клику на overlay
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        };

        // Инициализация
        log('Naberika инициализирован - Чистый JavaScript', 'success');
        log('Используйте кнопки для добавления блоков', 'info');
        log('Кликните по блоку для выбора, перетащите для перемещения', 'info');
        log('Клавиши: Delete - удалить, L - заблокировать, H - скрыть', 'info');
        log('Кликните по карточке для просмотра детальной информации', 'info');
        updateStats();
    </script>
</body>
</html>
